<script type="text/javascript">
// ho poso qui pq sino els PDIs creats a partir del link add_fields, no funcionen
$(function() {
      $(".text_autocomplete").autocomplete ({
      source: function( request, response ) {
        $.ajax({
           url: '/pdis',
           dataType: "json",
           data: {
            featureClass: "P",
            style: "full",
            maxRows: 12,
            request_term: request.term
           }, // end data
          success: function( data ) {
            response( $.map( data, function( item ) {
              return {
              	id: item.id,
                label: item.nom,
                value: item.nom,
                lat: item.coord_lat,
                lng: item.coord_lng
              } // end return
            })); // end response
          } // end success
        }); // end ajax
      }, // end source
      select: function (a, b) {
        var myLatlng = new google.maps.LatLng(b.item.lat,b.item.lng);
        var marker = new google.maps.Marker({
          position: myLatlng
        });
        marker.setMap(window.map);
        window.map.setCenter(marker.getPosition());
        window.map.setZoom(13);
      }
    }); // end autocomplete
  }); // end function

/*$( ".provant" ).on( "autocompleteselect", function( a,b) {
	alert(b.item.id);
	$('#selected_pdi').val(b.item.id);
} );*/
</script>

<%#= ui-state-default ui-widget %>
<li class="fields">
  <%= f.label :pdi, "PDI" %>
  <%= f.text_field :pdi, class: "text_autocomplete"%>
  <%= f.hidden_field :_destroy %>
  <%= link_to_function "Treure\'l", "remove_fields(this)" %>
</li>